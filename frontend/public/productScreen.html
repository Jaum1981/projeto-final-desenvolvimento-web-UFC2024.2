<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalhes do Produto</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../src/styles/productStyle.css" />
  </head>
  <body>
    <header>
      <img
        src="../src/media/logo.png"
        alt="Logo do site"
        width="50"
        height="50"
      />
      <span>Sistema de Doação de Alimentos</span>
      <button type="button" class="btn btn-primary">Entrar/Cadastrar</button>
    </header>

    <main class="product-container container my-5">
      <div class="row">
        <div class="col-md-6 text-center">
          <img
            id="product-image"
            src=""
            alt="Imagem do produto"
            class="img-fluid rounded product-image"
          />
        </div>
        <div class="col-md-6">
          <h1 id="product-title">Produto</h1>
          <p id="product-description">Descrição do produto</p>
          <p id="product-location">Local de Coleta: <strong></strong></p>
          <p id="product-expiry">Validade: <strong></strong></p>
          <div class="d-grid gap-2 mt-3">
            <button class="btn btn-primary btn-lg" id="solicitar-btn">
              Solicitar Doação
            </button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>
        &copy; 2025 Sistema de Doação de Alimentos. Todos os direitos
        reservados.
      </p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        carregarDetalhesProduto();
      });

      async function carregarDetalhesProduto() {
        const params = new URLSearchParams(window.location.search);
        let produtoId = params.get("id");

        try {
          // Verifique se o produtoId está como número e altere para o documentId
          if (produtoId && produtoId.length === 24) {
            // Se já for o documentId correto, não faz nada
          } else {
            // Recarrega a URL com o documentId correto
            produtoId = "d5cf960v7tqiffbkxp1vxvcj"; // Substitua pelo ID desejado
            window.history.replaceState({}, "", `?id=${produtoId}`);
          }

          // Use o documentId correto na URL para buscar os detalhes do produto
          const response = await fetch(
            `http://localhost:1337/api/alimentos/${produtoId}`
          );
          if (!response.ok) {
            throw new Error("Erro ao carregar detalhes do produto.");
          }

          const data = await response.json();
          if (!data.data) {
            throw new Error("Dados inválidos recebidos da API.");
          }

          const produto = data.data;
          const nome = produto.name || "Nome indisponível";
          const categoria = produto.category || "Sem categoria";
          const descricao = produto.description || "Sem descrição";
          const dataExpiracao = produto.expirationDate
            ? new Date(produto.expirationDate).toLocaleDateString("pt-BR")
            : "Sem data";
          const imagem = produto.imgURL || "https://via.placeholder.com/150";
          const local = produto.location || "Local não disponível"; // Verifique o campo correto no seu modelo de dados
          const validade = produto.expirationDate
            ? new Date(produto.expirationDate).toLocaleDateString("pt-BR")
            : "Data de validade não informada";

          // Preencher os detalhes do produto
          document.getElementById("product-title").textContent = nome;
          document.getElementById("product-description").textContent =
            descricao;
          document
            .getElementById("product-location")
            .querySelector("strong").textContent = local;
          document
            .getElementById("product-expiry")
            .querySelector("strong").textContent = validade;
          document.getElementById("product-image").src = imagem;
        } catch (error) {
          console.error(error);
          document.body.innerHTML =
            "<p class='text-danger'>Erro ao carregar os detalhes do produto.</p>";
        }
      }
    </script>
  </body>
</html>
